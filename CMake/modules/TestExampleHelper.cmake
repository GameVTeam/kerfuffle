IF (BUILD_TESTS)
  ADD_LIBRARY(test_helper INTERFACE)
  TARGET_SOURCES(test_helper INTERFACE tests/helper.h tests/helper.inl)
ENDIF ()

FUNCTION(CREATE_EXAMPLE)
  SET(TARGET_NAME ${ARGV0}_example)
  ADD_EXECUTABLE(${TARGET_NAME} examples/${ARGV0}.cc)
  ADD_DEPENDENCIES(${TARGET_NAME} kerfuffle)
ENDFUNCTION()

FUNCTION(CREATE_TEST)
  SET(TARGET_NAME ${ARGV0}_test)
  ADD_EXECUTABLE(${TARGET_NAME} tests/${ARGV0}.cc)
  ADD_DEPENDENCIES(${TARGET_NAME} kerfuffle test_helper)
  TARGET_LINK_LIBRARIES(${TARGET_NAME} ${GTEST_LIB})
  IF (ENABLE_COVERAGE)
    COVERAGE_TARGET(${TARGET_NAME})
  ENDIF ()
  ADD_TEST(NAME test_${ARGV0} COMMAND ${TARGET_NAME})
ENDFUNCTION()